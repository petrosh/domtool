/*  jUri v0.4.3
    Mini-javascript library for handling url functions
    jUri by Enric Florit is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.
    You can read the license at http://creativecommons.org/licenses/by-sa/3.0/

    Download the latest version at:
    http://github.com/3nr1c/jUri.js/downloads

    Email me:
    efz1005[at]gmail[dot]com */

var jUri=function(window){if(!window.console){var log=window.opera?window.opera.postError:alert;window.console={log:function(a){log(a)}};window.console.error=window.console.warn=window.console.debug=window.console.log}var nav=window.navigator,appCodeName=nav.appCodeName,appName=nav.appName,appVersion=nav.appVersion,language=nav.language,mimeTypes=nav.mimeTypes,platform=nav.platform,plugins=nav.plugins,userAgent=nav.userAgent;window.jUriReady=function(a){if(!document.body||!window.jUri){return setTimeout("window.jUriReady("+a+")",1)}a()};(function(){jUriReady(function(){var a=document.getElementsByTagName("a");for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.getAttribute("data-after");if(e){jUri.fn.addEvent(d,"click",function(a){a.preventDefault();var b=this.href,c=this.getAttribute("data-after");jUri.redirect(b,c)})}}})})();(function(){jUriReady(function(){var a=document.getElementsByTagName("*");for(var b=0,c=a.length;b<c;b++){var d=a[b],e=d.getAttribute("data-hash"),f=d.getAttribute("data-name");if(e||e==""){jUri.fn.addEvent(d,"click",function(a){var b=this.getAttribute("data-hash");jUri.hash(b)})}if(f&&!jUri.anchorExists(f)){var g=document.createElement("a");g.name=f;d.parentNode.insertBefore(g,d)}}jUri.anchorsCreated=true})})();jUriReady(function(){if(jUri.anchorExists(jUri.hash())){var a=jUri.fn.getAnchor(jUri.hash()),b=0;if(a&&a.offsetParent){do{b+=a.offsetTop}while(a=a.offsetParent)}window.scrollTo(0,b)}});return{host:function(){return window.location.host},hostname:function(){return window.location.hostname},href:function(){return window.location.href},pathname:function(){return window.location.pathname},port:function(){return window.location.port},protocol:function(){return window.location.protocol.replace(/:$/,"")},get:function(a){var b,c,d={};if(a&&a!==""){b=(a+"").replace(/^(.*?)\?/,"").split("&");for(c in b){var e=b[c].split("=");d[e[0]]=e[1]}}else{var f=window.location.search,g=f.replace(/^\?/,""),b=g.split("&");for(c in b){var e=b[c].split("=");d[e[0]]=e[1]}}return d},navigator:navigator,appCodeName:appCodeName,appName:appName,appVersion:appVersion,language:language,mimeTypes:mimeTypes,platform:platform,plugins:plugins,userAgent:userAgent,set:function(a,b,c,d){var e,f,g,h;if(typeof b=="boolean"){e=b}else{if(typeof b=="function"&&typeof c=="boolean"){e=c;c=d}e=false}if(history.pushState){if(!c)c=true;if(typeof a=="string"){f=a;g="";h={}}else{h=a.data||{};g=a.title||"";f=a.url||""}try{if(history.current==f){return false}}catch(i){}if(g!=""){this.title(g)}if(c){history.pushState(h,g,f)}else{history.replaceState(h,g,f)}if(!e){jUri.fn.jUriSet=true}}else if(b&&typeof b=="function"){b()}},back:function(a,b){try{window.history.back(a)}catch(c){if(b)b()}},forward:function(a,b){try{window.history.forward(a)}catch(c){if(b)b()}},title:function(a,b){if(typeof a=="string"){try{document.getElementsByTagName("title")[0].innerHTML=a.replace("<","<").replace(">",">").replace(" & "," & ")}catch(c){document.title=a}}else if(typeof a=="object"){if(!b)b=1500;jUri.fx.changeTitle.init(a,b)}return{stop:function(a){jUri.fx.changeTitle.stop();if(a!=""){jUri.title(a)}}}},hash:function(a,b){if(a&&a instanceof RegExp){if(window.location.hash.replace(/^#/,"").match(a)){b?b():false;return true}else{return false}}else if(a||a==""){window.location.hash=a;return a}else{return window.location.hash.replace(/^#/,"")}},hashchange:function(a){if(!document.body){return setTimeout("jUri.hashchange("+a+")",1)}var b=0;if(typeof window.pageYOffset=="number"){b=window.pageYOffset}else if(document.body.scrollTop){b=document.body.scrollTop}else if(document.documentElement.scrollTop){b=document.documentElement.scrollTop}this.fn.checkhash(this.hash(),b,a)},urlchange:function(a,b,c){if(!document.body){return setTimeout("jUri.urlchange("+a+","+b+","+c+")",1)}this.fn.checkurl(this.href(),a,b,c)},isHTTP:function(a){if(this.protocol().match(/^http$/)){a?a():false;return true}else{return false}},isHTTPS:function(a){if(this.protocol().match(/^https$/)){a?a():false;return true}else{return false}},parseAsGet:function(a){var b=(a+"").replace(/^(.*?)\?/,"").split("&"),c={};for(var d in b){var e=b[d].split("=");c[e[0]]=e[1]}window.console.warn("jUri.parseAsGet(str) is deprecated, use jUri.get(str) instead");return c},redirect:function(a,b){if(b&&b%1===0){setTimeout("window.location.href='"+a+"'",b)}else{window.location.href=a}},reload:function(a){if(a&&a%1===0){setTimeout("window.location.reload(true);",a)}else{window.location.reload(true)}},isFile:function(a){if(this.pathname().match(/\.(html|htm|php|phtml|asp|shtml|cgi|jsp|pl)$/i)){a?a():false;return true}else{return false}},anchorExists:function(a,b){var c=this.fn.getAnchor(a);if(c){b?b(c):false;return true}return false},anchorsCreated:false,animateAnchorLinks:function(a,b){if(!document.body||!jUri.anchorsCreated){return setTimeout('jUri.animateAnchorLinks("'+a+'",'+b+")",1)}if(typeof a=="boolean"){a="*";b=a}if(typeof b!="boolean"){b=true}var c=[],d=[],e=document.getElementsByTagName("a");if(!a||typeof a=="undefined"||a==="undefined"||a=="*"){for(var f in e){if(e[f].name&&e[f].name!=""){c.push(e[f].name)}}}else{var g=a.replace(/\s/gim,"").split(","),h;for(var f in g){h=g[f];c.push(this.fn.getAnchor(h).name)}}for(var i in c){for(var f in e){if(e[f].href&&e[f].href!=""&&e[f].href.match("#"+c[i]+"$")){d.push(e[f])}else if(e[f].href&&e[f].href.match(/#$/)){d.push(e[f])}}}d=this.fn.removeDuplicated(d);for(var i in d){jUri.fn.addEvent(d[i],"click",function(a){a.preventDefault();var c=this.href.split("#")[1];jUri.fn.gotoAnchor(c,function(){if(b==true)jUri.hash(c)})})}},encode:function(a){return encodeURIComponent(a)},bindToUrl:function(a){var b=jUri.fn.select(a),c,d;for(var e=0,f=b.length;e<f;e++){c=b[e];if(c&&!c.bound){d=c.innerHTML;c.urlCopies=[{url:jUri.href(),html:d}];c.bound=true;c.selector=jUri.fn.getSelector(c);var g=jUri.fn.boundElements.length;jUri.fn.boundElements[g]=c}}if(b.length){jUri.urlchange(function(a){for(var b in jUri.fn.boundElements){var c=jUri.fn.boundElements[b],d=c.urlCopies,e=c.selector,f=jUri.fn.select(e)[0];for(var g=0,h=d.length;g<h;g++){if(d[g].url==a.newUrl){if(typeof d[g].html=="string"){f.innerHTML=d[g].html}else if(typeof d[g].AJAXurl=="string"){jUri.ajax({url:d[g].AJAXurl,target:e})}break}}}});jUri.urlchange(function(a){for(var b in jUri.fn.boundElements){var c=jUri.fn.boundElements[b],d=false,e=c.urlCopies,f,g=c.selector,h=jUri.fn.select(g)[0],i=h.innerHTML;for(var j=0,k=e.length;j<k;j++){if(e[j].url==a.newUrl){d=true;break}}if(!d){f=e.length;c.urlCopies[f]={url:a.newUrl,html:i}}}},false,true)}return},ajax:function(data){if(typeof data=="object"){if(data.url){url=data.url}else{return false}if(data.method){method=data.method}else{method="GET"}if(data.async){async=data.async}else{async=true}if(data.callback&&typeof data.callback=="function"){callback=data.callback}else{callback=new Function}if(data.form&&typeof data.form=="string"){form=jUri.fn.select(data.form)[0]}else if(data.form&&typeof data.form=="object"){form=data.form}else{form=false}}else if(typeof data=="string"){url=data;method="GET";async=true}else{return false}var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest}else if(window.ActiveXObject){try{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){xmlhttp=new ActiveXObject("Msxml2.XMLHTTP")}}if(form){xmlhttp.open("POST",url,async)}else{xmlhttp.open(method,url,async)}if(typeof data=="string")return xmlhttp;xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){if(data.target){var targets=jUri.fn.select(data.target),response=xmlhttp.responseText,tl=targets.length;if(data.bindToUrl){jUri.bindToUrl(data.target)}for(var i=0;i<tl;i++){targets[i].innerHTML=response}}if(data.setUrl){var forceEvent=foundScript=false;for(var i=0;i<tl;i++){foundScript=function(a){return/<script[^>]*>(.|\n|\t)*?<\/script>/gim.test(a)}(targets[i].innerHTML);if(targets[i].innerHTML.length>1024&&!foundScript){forceEvent=true;break}}if(data.bindToUrl&&data.target&&forceEvent){jUri.set(data.setUrl,true)}else{jUri.set(data.setUrl)}}if(data.target&&forceEvent){var boundElementsLength=jUri.fn.boundElements.length;for(var i=0;i<tl;i++){var el=jUri.fn.boundElements[boundElementsLength-(tl-i)],has_copy=false,copies;if(!el.urlCopies)el.urlCopies=[];copies=el.urlCopies;for(var e=0,l=el.urlCopies.length;e<l;e++){if(copies[e].AJAXurl&&copies[e].AJAXurl==url){has_copy=true;break}}if(has_copy==true)continue;el.urlCopies.push({url:jUri.href(),AJAXurl:url});jUri.fn.boundElements[boundElementsLength-(tl-i)]=el}}if(data.response){response=data.response.toLowerCase()}else{response="html"}if(response=="json"){try{responseText=eval("("+xmlhttp.responseText+")")}catch(e){responseText={}}}else{responseText=xmlhttp.responseText}callback(responseText)}};if(form){var formdata,uA=jUri.userAgent.toLowerCase(),isChrome=/\bchrome\b/i.test(uA),isSafari=!isChrome&&/safari/.test(uA);if(window.FormData&&!isSafari){formdata=new FormData(form)}else{xmlhttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");var children,i,l,child,formdata="";children=form.childNodes;for(i=0,l=children.length;i<l;i++){if(typeof children[i]!="object"||children[i].tagName==null&&children[i].localName==null){continue}child=children[i];if(child.getAttribute("name")){var name=child.getAttribute("name"),value=child.value;if(formdata!="")formdata+="&";formdata+=name+"="+jUri.encode(value)}}}xmlhttp.send(formdata)}else{xmlhttp.send(null)}return xmlhttp},fn:{checkhash:function(a,b,c){if(jUri.hash()!=a){c(new hashChangeEvent(a,jUri.hash(),b));var b=0;if(typeof window.pageYOffset=="number"){scroll=window.pageYOffset}else if(document.body.scrollTop){scroll=document.body.scrollTop}else if(document.documentElement.scrollTop){scroll=document.documentElement.scrollTop}}setTimeout('jUri.fn.checkhash("'+jUri.hash()+'",'+b+","+c+")",1)},jUriSet:false,checkurl:function(a,b,c,d){if(jUri.href()!=a){if(!d){if(jUri.fn.jUriSet){jUri.fn.jUriSet=false;return setTimeout('jUri.fn.checkurl("'+jUri.href()+'",'+b+","+c+","+d+")",1)}}else{jUri.fn.jUriSet=false}if(!c){if(jUri.href().split("#")[0]==a.split("#")[0]){return setTimeout('jUri.fn.checkurl("'+jUri.href()+'",'+b+","+c+","+d+")",1)}}b(new urlChangeEvent(a,jUri.href()))}setTimeout('jUri.fn.checkurl("'+jUri.href()+'",'+b+","+c+","+d+")",1)},pageScroll:function(a,b){if(!document.body){return setTimeout("jUri.fn.pageScroll("+a+")",1)}jUri.fx.scroller.scrollTo(a,b)},getAnchor:function(a){if(!document.body){return setTimeout("jUri.fn.getAnchor("+a+")",1)}if(!a){return null}if(a.match(/^#/))a=a.replace(/^#/,"");var b=document.getElementsByTagName("a");for(var c in b){element=b[c];if(element.name&&element.name.replace(/^#/,"")===a){return element}}return null},gotoAnchor:function(a,b){var c=jUri.fn.getAnchor(a),d=0;if(c&&c.offsetParent){do{d+=c.offsetTop}while(c=c.offsetParent)}jUri.fn.pageScroll(d,b)},removeDuplicated:function(a,b){var c=new Array;if(typeof b=="undefined"){a:for(var d in a){for(var e in c){if(c[e]==a[d])continue a}c[c.length]=a[d]}}else{a:for(var d in a){for(var e in c){if(c[e][b]==a[d][b])continue a}c[c.length]=a[d]}}return c},addEvent:function(){if(document.addEventListener){return function(a,b,c){if(a&&a.nodeName||a===window){a.addEventListener(b,c,false)}else if(a&&a.length){for(var d=0;d<a.length;d++){jUri.fn.addEvent(a[d],b,c)}}}}else{return function(a,b,c){if(a&&a.nodeName||a===window){a.attachEvent("on"+b,function(){return c.call(a,window.event)})}else if(a&&a.length){for(var d=0;d<a.length;d++){jUri.fn.addEvent(a[d],b,c)}}}}}(),select:function(a){if(document.querySelectorAll){try{var b=document.querySelectorAll(a);return b}catch(c){return[]}}},css3Selectors:function(a){try{a.querySelectorAll("html:nth-child(1)");return true}catch(b){return false}}(window.document),getSelector:function(a){var b=a.localName||a.tagName.toLowerCase(),c=a.getAttribute("id"),d=a.parentNode,e=function(a,b){var c,d,e=a.localName||a.tagName.toLowerCase(),f=0,g,c=jUri.fn.select(b),d=c.length-1;if(c.length==1){return b}for(var h=0,i=c.length;h<i;h++){if(a==c[h]&&""!="v"||""=="v"&&a.innerHTML==c[h].innerHTML){if(h==0){b+=":first-of-type"}else if(h==d){b+=":last-of-type"}else if(jUri.fn.css3Selectors===true){b+=":nth-of-type("+(h+1)+")"}else{var j="";while(f<h){j+=" + "+e;f++}b+=j}break}}if(jUri.fn.select(b).length==1||""=="v"){return b}},f=b;if(jUri.fn.select(f).length==1){return f}var g,h;if(typeof c=="string"&&c!=""){var g=jUri.fn.select(c),h=g.length-1;f+="#"+c;if(jUri.fn.select(f).length==1){return f}}return e(a,f)},boundElements:[]},fx:{scroller:{stepIncrement:20,stepDelay:1,limit:6e3,running:false,nextStep:null,killTimeout:null,finalPoint:null,callback:null,scrollStep:function(a,b,c){var d=jUri.fx.scroller.stepIncrement,e=jUri.fx.scroller.running;if(!e||c&&a>=b||!c&&a<=b){jUri.fx.scroller.killScroll();return}if(c&&a>=b-2*d||!c&&a<=b-2*d){d=d*.55}window.scrollTo(0,a);jUri.fx.scroller.nextStep=jUri.fx.scroller.callNext(+a+d,b,c);jUri.fx.scroller.stepIncrement=d;window.setTimeout(jUri.fx.scroller.nextStep,jUri.fx.scroller.stepDelay)},callNext:function(a,b,c){return function(){jUri.fx.scroller.scrollStep(a,b,c)}},scrollTo:function(a,b){if(jUri.fx.scroller.running)return false;jUri.fx.scroller.running=true;jUri.fx.scroller.callback=b;jUri.fx.scroller.finalPoint=a;var c=document.all?document.body.scrollTop:window.pageYOffset,d=true,e=jUri.fx.scroller.stepIncrement;if(c==a){jUri.fx.scroller.killScroll()}if(c>a){e*=-1;d=false}jUri.fx.scroller.killTimeout=window.setTimeout(jUri.fx.scroller.killScroll,jUri.fx.scroller.limit);jUri.fx.scroller.stepIncrement=e;jUri.fx.scroller.scrollStep(c+e,a,d)},killScroll:function(){window.clearTimeout(jUri.fx.scroller.killTimeout);jUri.fx.scroller.running=false;jUri.fx.scroller.stepIncrement=20;window.scrollTo(0,jUri.fx.scroller.finalPoint);jUri.fx.scroller.finalPoint=null;typeof jUri.fx.scroller.callback=="function"?jUri.fx.scroller.callback():false;jUri.fx.scroller.callback=null}},changeTitle:{active:false,obj:[],current:0,timeNext:1500,timeOut:null,init:function(a,b){if(jUri.fx.changeTitle.active)return false;jUri.fx.changeTitle.active=true;jUri.fx.changeTitle.obj=a;jUri.fx.changeTitle.timeNext=b;jUri.fx.changeTitle.callNext()},callNext:function(){var a=jUri.fx.changeTitle.current,b=jUri.fx.changeTitle.obj,c=jUri.fx.changeTitle.timeNext;if(b[a]){jUri.title(b[a]);jUri.fx.changeTitle.current=a+1}else{jUri.title(b[0]);jUri.fx.changeTitle.current=0}jUri.fx.changeTitle.timeOut=setTimeout(jUri.fx.changeTitle.callNext,c)},stop:function(){jUri.fx.changeTitle.active=false;jUri.fx.changeTitle.obj=false;jUri.fx.changeTitle.current=false;jUri.fx.changeTitle.timeNext=1500;window.clearTimeout(jUri.fx.changeTitle.timeOut)}}},log:function(a){console.log(a)},debug:function(a){console.debug(a)},warn:function(a){console.warn(a)},error:function(a){console.error(a)},"short":function(a){window[a]=jUri}}}(window),hashChangeEvent=function(a,b){this.oldHash=a||"#";this.newHash=b||"#";this.oldUrl=history.previous||"";this.newUrl=jUri.href()||"";this.newLoc=window.location};urlChangeEvent=function(a,b){this.oldUrl=a||"#";this.newUrl=b||"#";this.newLoc=window.location};window.jUri=jUri
